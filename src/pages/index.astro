---
// src/pages/index.astro

// Imports dos componentes
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import ServiceSection from '../components/ServiceSection.astro';
import Card from '../components/Card.astro';
import ContactForm from '../components/ContactForm.astro';
import BlogHighlight from '../components/BlogHighlight.astro';

// Imports do Astro para buscar conteúdo
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content'; // 1. Importe o tipo!

// Busca os posts da coleção 'blog'
const allPosts = await getCollection('blog');

// Ordena os posts por data
const sortedPosts = allPosts.sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Pega apenas os 3 mais recentes
const recentPosts = sortedPosts.slice(0, 3);
---

<Layout
    title="ELOnARTE | Conectando Arte, Terapia & Tecnologia"
    description="Explore um universo onde arte, terapias integrativas e tecnologias inovadoras se encontram."
>
    <div class="container">
        <Hero />
        
        {/* ... outras seções do seu site ... */}
        
        {recentPosts.length > 0 && (
            <section id="blog-highlight" class="service-section">
                <h2 style="color: var(--color-text-primary);">Últimas do Blog</h2>
                <p class="subtitle">Nossas reflexões mais recentes sobre arte, tecnologia e consciência.</p>
                <div class="cards-grid">
                    {/* 2. Aplique o tipo ao parâmetro 'post' */}
                    {recentPosts.map((post: CollectionEntry<'blog'>) => (
                        <a href={`/blog/${post.slug}/`} class="card-link">
                            <Card title={post.data.title} description={post.data.description} />
                        </a>
                    ))}
                </div>
                <div class="cta-container">
                    <a href="/blog" class="btn">Ver Todas as Publicações</a>
                </div>
            </section>
        )}

        <ContactForm />
    </div>
</Layout>